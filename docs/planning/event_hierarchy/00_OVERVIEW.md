# 이벤트 계층화 (Event Hierarchy) 마스터 플랜

**작성일**: 2026-01-28
**목표**: 수천 개의 개별 이벤트를 의미 있는 계층 구조로 조직화하여 사용자 경험 개선

---

## 1. 문제 정의

### 현재 상황
- 모든 이벤트가 평면적으로 나열됨
- 특정 시대/지역에 이벤트가 집중되면 압도적
- "백년전쟁"과 "아쟁쿠르 전투"가 같은 레벨로 표시
- 사용자가 큰 그림을 파악하기 어려움

### 목표
- **줌 레벨에 따른 표시**: 멀리서 보면 "백년전쟁", 가까이서 보면 개별 전투
- **의미 있는 그룹화**: 관련 이벤트를 논리적으로 묶음
- **정보 과부하 방지**: 기본적으로 중요 이벤트만 표시

---

## 2. 이벤트 계층 분류 체계

### 2.1 계층 레벨 정의

```
Level 0: 시대 (Era)           → 예: 고대, 중세, 근대
Level 1: 대사건 (Mega-Event)  → 예: 로마 제국의 흥망, 대항해시대
Level 2: 집합 사건 (Aggregate) → 예: 백년전쟁, 십자군 전쟁
Level 3: 주요 사건 (Major)    → 예: 아쟁쿠르 전투, 예루살렘 함락
Level 4: 세부 사건 (Minor)    → 예: 특정 조약, 소규모 교전
```

### 2.2 Aggregate Event 유형

| 유형 | 설명 | 예시 |
|------|------|------|
| **전쟁 (War)** | 여러 전투/조약으로 구성 | 백년전쟁, 나폴레옹 전쟁, 세계대전 |
| **운동 (Movement)** | 사회/문화적 흐름 | 르네상스, 종교개혁, 계몽주의 |
| **왕조/정권 (Dynasty)** | 한 왕조의 주요 사건들 | 한 왕조, 오스만 제국 |
| **탐험/원정 (Expedition)** | 연속된 탐험 활동 | 십자군, 대항해시대 |
| **혁명 (Revolution)** | 정치적 격변기 | 프랑스 혁명, 산업혁명 |
| **위기 (Crisis)** | 연속된 위기 상황 | 흑사병, 대공황 |

---

## 3. 상위 이벤트 (Aggregate Events) 목록

### 3.1 고대 (BCE 3000 - 500 CE)

#### 전쟁/정복
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 트로이 전쟁 | BCE 1260-1180 | 목마 작전, 헥토르 전사 |
| 페르시아 전쟁 | BCE 499-449 | 마라톤 전투, 테르모필레, 살라미스 해전 |
| 펠로폰네소스 전쟁 | BCE 431-404 | 시칠리아 원정, 아이고스포타모이 해전 |
| 알렉산더 대왕의 정복 | BCE 334-323 | 이소스 전투, 가우가멜라 전투 |
| 포에니 전쟁 | BCE 264-146 | 칸나이 전투, 자마 전투, 카르타고 파괴 |
| 갈리아 전쟁 | BCE 58-50 | 알레시아 포위전 |
| 로마 내전 | BCE 49-45 | 파르살루스 전투, 루비콘 도하 |

#### 문명/왕조
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 이집트 고왕국 | BCE 2686-2181 | 피라미드 건설 |
| 이집트 신왕국 | BCE 1550-1077 | 카데시 전투, 투탕카멘 |
| 로마 공화정 | BCE 509-27 | 12표법, 그라쿠스 형제 개혁 |
| 로마 제정 | BCE 27 - 476 CE | 아우구스투스 즉위, 서로마 멸망 |
| 진한 통일 | BCE 221-206 | 진시황 즉위, 만리장성, 분서갱유 |

### 3.2 중세 (500 - 1500 CE)

#### 전쟁/정복
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 이슬람 정복 | 632-750 | 야르무크 전투, 투르-푸아티에 전투 |
| 십자군 전쟁 | 1095-1291 | 예루살렘 함락(1099), 하틴 전투, 아크레 함락 |
| 몽골 정복 | 1206-1368 | 칭기즈칸 즉위, 바그다드 함락, 아인잘루트 전투 |
| 백년전쟁 | 1337-1453 | 크레시 전투, 푸아티에 전투, 아쟁쿠르, 오를레앙 포위전 |
| 레콩키스타 | 711-1492 | 코바동가 전투, 그라나다 함락 |
| 비잔틴-오스만 전쟁 | 1299-1453 | 콘스탄티노플 함락 |

#### 시대/운동
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 카롤링거 르네상스 | 780-900 | 샤를마뉴 대관식, 아헨 궁정 학교 |
| 바이킹 시대 | 793-1066 | 린디스판 약탈, 노르망디 정착, 헤이스팅스 전투 |
| 흑사병 | 1347-1351 | 시칠리아 상륙, 유럽 전파, 인구 감소 |

### 3.3 근세 (1500 - 1800)

#### 전쟁
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 이탈리아 전쟁 | 1494-1559 | 파비아 전투, 로마 약탈 |
| 30년 전쟁 | 1618-1648 | 프라하 창문투척, 뤼첸 전투, 베스트팔렌 조약 |
| 7년 전쟁 | 1756-1763 | 로스바흐 전투, 퀘벡 전투 |
| 미국 독립전쟁 | 1775-1783 | 렉싱턴-콩코드, 요크타운 항복, 파리 조약 |
| 프랑스 혁명 전쟁 | 1792-1802 | 발미 전투, 이탈리아 원정 |
| 나폴레옹 전쟁 | 1803-1815 | 아우스터리츠, 트라팔가르, 워털루 |

#### 시대/운동
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 르네상스 | 1400-1600 | 메디치 후원, 시스티나 성당 완성 |
| 대항해시대 | 1415-1600 | 콜럼버스 항해, 바스코 다 가마, 마젤란 |
| 종교개혁 | 1517-1648 | 95개조 반박문, 아우크스부르크 화의 |
| 계몽주의 | 1685-1815 | 백과전서 출판, 미국 독립선언 |
| 산업혁명 | 1760-1840 | 방적기 발명, 증기기관, 철도 개통 |
| 프랑스 혁명 | 1789-1799 | 바스티유 습격, 공포정치, 나폴레옹 쿠데타 |

### 3.4 근현대 (1800 - 현재)

#### 전쟁
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 미국 남북전쟁 | 1861-1865 | 포트 섬터, 게티즈버그, 애퍼매턱스 항복 |
| 제1차 세계대전 | 1914-1918 | 사라예보 암살, 솜 전투, 베르됭, 휴전 |
| 제2차 세계대전 | 1939-1945 | 폴란드 침공, 진주만, 스탈린그라드, D-Day, 히로시마 |
| 한국전쟁 | 1950-1953 | 인천상륙, 장진호, 휴전협정 |
| 베트남 전쟁 | 1955-1975 | 통킹만 사건, 테트 공세, 사이공 함락 |
| 냉전 | 1947-1991 | 베를린 봉쇄, 쿠바 미사일, 베를린 장벽 붕괴 |

#### 시대/운동
| 상위 이벤트 | 기간 | 포함 이벤트 예시 |
|------------|------|-----------------|
| 제국주의 시대 | 1870-1914 | 베를린 회의, 아편전쟁, 청일전쟁 |
| 대공황 | 1929-1939 | 검은 목요일, 뉴딜 정책 |
| 민권운동 | 1954-1968 | 브라운 판결, 워싱턴 대행진, MLK 암살 |
| 탈식민지화 | 1945-1975 | 인도 독립, 아프리카의 해(1960) |

---

## 4. 스키마 변경

### 4.1 Event 모델 확장

```python
# backend/app/models/event.py 추가

class Event(Base):
    # ... 기존 필드 ...

    # 계층 구조
    parent_event_id = Column(Integer, ForeignKey('events.id'), nullable=True, index=True)
    is_aggregate = Column(Boolean, default=False, index=True)
    hierarchy_level = Column(Integer, default=3)  # 0=Era, 1=Mega, 2=Aggregate, 3=Major, 4=Minor

    # 자식 이벤트 관계
    children = relationship('Event',
                           backref=backref('parent', remote_side=[id]),
                           lazy='dynamic')

    # 표시 설정
    default_collapsed = Column(Boolean, default=False)  # 기본적으로 접혀있는지
    min_zoom_level = Column(Float, default=1.0)  # 이 줌 레벨 이상에서만 표시
```

### 4.2 마이그레이션

```python
# backend/alembic/versions/XXX_add_event_hierarchy.py

def upgrade():
    op.add_column('events', sa.Column('parent_event_id', sa.Integer(), nullable=True))
    op.add_column('events', sa.Column('is_aggregate', sa.Boolean(), default=False))
    op.add_column('events', sa.Column('hierarchy_level', sa.Integer(), default=3))
    op.add_column('events', sa.Column('default_collapsed', sa.Boolean(), default=False))
    op.add_column('events', sa.Column('min_zoom_level', sa.Float(), default=1.0))

    op.create_index('ix_events_parent_event_id', 'events', ['parent_event_id'])
    op.create_index('ix_events_is_aggregate', 'events', ['is_aggregate'])
    op.create_index('ix_events_hierarchy_level', 'events', ['hierarchy_level'])

    op.create_foreign_key(
        'fk_events_parent_event',
        'events', 'events',
        ['parent_event_id'], ['id']
    )
```

---

## 5. API 변경

### 5.1 새 엔드포인트

```python
# GET /api/v1/events/hierarchy
# 계층적 이벤트 트리 반환

# GET /api/v1/events/{id}/children
# 특정 이벤트의 자식 이벤트들

# GET /api/v1/events/aggregates
# 상위 이벤트(집합 이벤트)만 반환

# GET /api/v1/events?hierarchy_level=2&zoom=5.0
# 줌 레벨에 맞는 이벤트만 반환
```

### 5.2 기존 API 수정

```python
# GET /api/v1/events
# 새 파라미터 추가:
#   - include_children: bool (기본 False)
#   - max_hierarchy_level: int (기본 2 = Aggregate까지만)
#   - zoom_level: float (글로브 줌에 따른 필터)
```

---

## 6. 프론트엔드 UX

### 6.1 글로브 표시 로직

```
줌 레벨 1-3 (멀리):
  - hierarchy_level 0-1만 표시
  - 시대/대사건 마커

줌 레벨 4-6 (중간):
  - hierarchy_level 0-2까지 표시
  - Aggregate 이벤트 (백년전쟁 등)

줌 레벨 7-10 (가까이):
  - 모든 레벨 표시
  - 개별 전투/사건 마커
```

### 6.2 사이드바 UI

```
▼ 중세 (500-1500)
  ▼ 십자군 전쟁 (1095-1291)         [12 events]
    ├─ 제1차 십자군 (1096-1099)     [5 events]
    │   ├─ 예루살렘 함락 (1099)
    │   └─ ...
    ├─ 제2차 십자군 (1147-1149)
    └─ ...
  ▼ 백년전쟁 (1337-1453)            [23 events]
    ├─ 크레시 전투 (1346)
    ├─ 푸아티에 전투 (1356)
    └─ ...
  ► 몽골 정복 (1206-1368)           [15 events] (접힘)
```

### 6.3 필터 옵션

```
□ 중요 이벤트만 (importance ≥ 4)
□ 상위 이벤트만 (Aggregate)
□ 자동 줌 필터 (글로브 줌에 따라)

계층 레벨:
[====|====] 0 - - - - 4
     ^현재: 2 (Aggregate까지)
```

---

## 7. 데이터 큐레이션 프로세스

### 7.1 Phase 1: 상위 이벤트 생성

1. 위 목록의 Aggregate 이벤트를 DB에 생성
2. `is_aggregate = True`, `hierarchy_level = 2` 설정
3. 적절한 `importance` (보통 4-5) 설정

### 7.2 Phase 2: 기존 이벤트 연결

1. 기존 이벤트 중 상위 이벤트에 속하는 것 식별
2. `parent_event_id` 설정
3. `hierarchy_level = 3 또는 4` 설정

### 7.3 Phase 3: 검증

1. 고아 이벤트 (부모 없는) 확인
2. 시간 범위 정합성 검증 (자식이 부모 기간 내에 있는지)
3. 지리적 정합성 검증

### 7.4 자동화 스크립트

```python
# poc/scripts/link_events_to_aggregates.py

AGGREGATE_MAPPINGS = {
    "Hundred Years' War": {
        "year_range": (1337, 1453),
        "keywords": ["Crécy", "Poitiers", "Agincourt", "Orleans", "Joan of Arc"],
        "location_ids": [france_id, england_id]
    },
    "Crusades": {
        "year_range": (1095, 1291),
        "keywords": ["Crusade", "Jerusalem", "Saladin", "Richard", "Acre"],
        "location_ids": [jerusalem_id, constantinople_id]
    },
    # ...
}
```

---

## 8. 구현 일정

### Week 1: 스키마 & 기본 구조
- [ ] Alembic 마이그레이션 생성
- [ ] Event 모델 확장
- [ ] 기본 API 수정

### Week 2: 상위 이벤트 생성
- [ ] Aggregate 이벤트 목록 최종 확정
- [ ] DB에 상위 이벤트 삽입
- [ ] 스크립트로 기존 이벤트 연결

### Week 3: 프론트엔드
- [ ] 사이드바 트리 UI
- [ ] 글로브 줌 기반 필터
- [ ] 필터 패널 옵션 추가

### Week 4: QA & 조정
- [ ] 데이터 정합성 검증
- [ ] UX 피드백 반영
- [ ] 성능 최적화

---

## 9. 성공 지표

| 지표 | 현재 | 목표 |
|------|------|------|
| 기본 표시 이벤트 수 | ~2000 | ~200 (Aggregate) |
| 사용자 클릭 depth | 1 (평면) | 2-3 (계층) |
| 정보 탐색 시간 | ? | 50% 감소 |
| "압도적" 피드백 | 있음 | 없음 |

---

## 10. 향후 확장

### 10.1 자동 클러스터링
- 시간/공간적 근접성 기반 자동 그룹화
- ML 기반 주제 클러스터링

### 10.2 사용자 정의 체인
- 사용자가 직접 이벤트 그룹 생성
- 공유 가능한 "역사 스토리"

### 10.3 시각화 개선
- 타임라인에서 계층 표시
- 관계 그래프 시각화

---

## 부록: 주요 Aggregate Events 상세

### A. 백년전쟁 (1337-1453)

**상위 정보**
- title: "Hundred Years' War"
- title_ko: "백년전쟁"
- date_start: 1337
- date_end: 1453
- is_aggregate: True
- hierarchy_level: 2
- importance: 5

**포함 이벤트**
| 이벤트 | 연도 | hierarchy_level |
|--------|------|-----------------|
| 에드워드 3세 프랑스 왕위 주장 | 1337 | 3 |
| 슬로이스 해전 | 1340 | 4 |
| 크레시 전투 | 1346 | 3 |
| 칼레 포위전 | 1346-1347 | 4 |
| 흑사병 휴전 | 1348-1355 | 4 |
| 푸아티에 전투 | 1356 | 3 |
| 브레티니 조약 | 1360 | 3 |
| 아쟁쿠르 전투 | 1415 | 3 |
| 트루아 조약 | 1420 | 3 |
| 오를레앙 포위전 | 1428-1429 | 3 |
| 잔 다르크 화형 | 1431 | 3 |
| 카스티용 전투 | 1453 | 3 |

### B. 십자군 전쟁 (1095-1291)

**상위 정보**
- title: "The Crusades"
- title_ko: "십자군 전쟁"
- date_start: 1095
- date_end: 1291
- is_aggregate: True
- hierarchy_level: 2
- importance: 5

**하위 집합 이벤트**
| 이벤트 | 기간 | hierarchy_level |
|--------|------|-----------------|
| 제1차 십자군 | 1096-1099 | 2 |
| 제2차 십자군 | 1147-1149 | 2 |
| 제3차 십자군 | 1189-1192 | 2 |
| 제4차 십자군 | 1202-1204 | 2 |
| 아동 십자군 | 1212 | 3 |
| 제5-9차 십자군 | 1217-1272 | 2 |

**제1차 십자군 포함 이벤트**
| 이벤트 | 연도 | hierarchy_level |
|--------|------|-----------------|
| 클레르몽 공의회 | 1095 | 3 |
| 은자 피에르의 민중 십자군 | 1096 | 4 |
| 니케아 포위전 | 1097 | 4 |
| 안티오키아 포위전 | 1097-1098 | 3 |
| 예루살렘 함락 | 1099 | 3 |
| 예루살렘 왕국 건국 | 1099 | 3 |
