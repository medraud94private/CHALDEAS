# 2026-01-19 작업 계획

## 완료된 작업 (1/18 ~ 1/19 새벽)

### Phase 1: Wikipedia 보강 ✅
| 항목 | 결과 |
|------|------|
| Persons | 200,427개 (에러 60) |
| Events | 267,363개 (에러 66) |
| Locations | 821,839개 (에러 36) |
| 에러율 | 0.013% |

### Phase 2: 관계 생성 ✅
| 방법 | 완료 |
|------|------|
| 하이퍼링크 기반 | ✅ |
| 본문 언급 기반 | ✅ |
| 공유 소스 기반 | ✅ |

**최종 관계 현황:**
| 테이블 | 레코드 수 |
|--------|-----------|
| person_relationships | 384,990 |
| event_persons | 1,133,748 |
| event_locations | 179,639 |
| person_locations | 610,502 |

### Phase 3: 티어 분석 ✅
- 연결된 엔티티: 271,044 (72.5%)
- 고아 엔티티: 102,882 (27.5%)

---

## 현재 진행 중

### Event-Event, Location-Location 관계 생성 ✅
- [x] Event-Event 관계 생성 → 193,201개
- [x] Location-Location 관계 생성 → 18,636개

---

## 오늘 할 일

### 1. 관계 완성 ✅
- [x] Event-Event 관계 완료
- [x] Location-Location 관계 완료
- [x] 전체 관계 현황 재집계

**최종 관계 현황 (전체):**
| 테이블 | 레코드 수 |
|--------|-----------|
| person_relationships | 384,990 |
| event_persons | 1,133,748 |
| event_locations | 179,639 |
| person_locations | 610,502 |
| event_relationships | 193,201 |
| location_relationships | 18,636 |
| **총합** | **2,520,716** |

### 2. Sources 테이블 임포트 ✅
- [x] enriched 데이터 → Sources.content 임포트
- [x] entity-source 연결 생성
- [x] wikidata_id 업데이트
- 결과: 88,793 sources, 87,961 with content

### 3. 데이터 정리 ✅
- [x] "Commons", "Other", "London" 등 오탐 제거 (44,128개)
- [x] 일반적인 단독 이름 (William, Henry 등) 정리
- [ ] Location 고아율 개선 방안 검토 (향후)

### 4. 품질 검증
- [x] 관계 강도(strength) 재계산 (`update_person_relationship_strength.py`)
  - 573,857개 person_relationships에 적용
  - 강함(>=10): 157,275개, 매우 강함(>=30): 89,971개
- [x] 고아 엔티티 필터링 구현 (`update_connection_counts.py`)
  - connection_count 컬럼 추가 (persons, events, locations)
  - 기본 목록 API: 고아 제외 (`include_orphans=true`로 오버라이드)
  - 검색 API: 모든 결과 표시 (사용자가 명시적 검색)
- [ ] 샘플 데이터 수동 검증
- [ ] 시대 기반 관계 분류 (contemporary vs historical_reference)

## 최종 현황 (2026-01-19)

### 관계 테이블
| 테이블 | 레코드 수 |
|--------|-----------|
| person_relationships | 573,857 |
| event_persons | 1,125,688 |
| event_locations | 179,639 |
| person_locations | 609,513 |
| event_relationships | 193,201 |
| location_relationships | 18,636 |
| **총합** | **2,700,534** |

### Sources
- 총: 88,793
- content 있음: 87,961

---

## 다음 단계 (향후)

### Phase A: V2 데이터 파이프라인
- `docs/planning/DATA_PIPELINE_V2.md` 참조
- User 시나리오 기반 데이터 흐름

### Phase B: Story Curation
- `docs/planning/STORY_CURATION_SYSTEM.md` 참조
- 역사의 고리 자동 생성

### Phase C: UI 개선
- Globe 시각화 개선
- Timeline 성능 최적화

---

## 관련 문서

### 완료된 계획 (→ completed/ 이동 대상)
- `2026-01-18_RECOVERY_PLAN.md` → Phase 1~4 완료
- `2026-01-18_FULL_POSTMORTEM.md` → 분석 완료

### 활성 계획
- `DATA_PIPELINE_V2.md`
- `STORY_CURATION_SYSTEM.md`
- `TIMELINE_PERFORMANCE.md`
