# Pre-Curation Readiness Checklist

**Date**: 2026-01-08
**Status**: In Progress
**Related**: `DATA_PIPELINE_V2.md`

---

## Executive Summary

큐레이션(Historical Chain 생성, 멀티소스 요약 등)을 시작하기 전에 필요한 기초 데이터 준비 상태를 체크합니다.

### 현재 상태 요약

| 항목 | 현재 | 목표 | 상태 |
|-----|------|------|------|
| Events | 10,428 | 10,428 enriched | 🔄 진행중 |
| Event 메타데이터 품질 | ~40% 정확 | 95%+ 정확 | 🔄 진행중 |
| Persons | ~3,000+ | 정리됨 | ⏳ 대기 |
| Locations | ~2,000+ | 정리됨 | ⏳ 대기 |
| Source-Event 연결 | text_mentions | 검증됨 | ⏳ 대기 |

---

## Phase 1: Event Enrichment (현재 단계)

### CP-1.1: 엔리치먼트 스크립트 준비 ✅

- [x] `enrich_events_llm.py` 스크립트 작성
- [x] gpt-5.1-chat-latest API 호환성 확인 (max_completion_tokens)
- [x] 100건 테스트 완료 (100% 성공률)
- [x] 비용 산정 완료 (~$80 for 10,428 events)

### CP-1.2: 요약 제거 및 프롬프트 수정 ✅

- [x] 엔리치먼트 프롬프트에서 summary 필드 제거
- [x] 요약 없이 테스트 실행 (5건)
- [x] 토큰 사용량 감소 확인: ~21% 절감 (출력 토큰 350→254/건)

**Why**: 요약은 단일 이벤트가 아닌 멀티소스 집계가 필요함 (큐레이션 단계)

### CP-1.3: 전체 엔리치먼트 실행 ✅

- [x] 전체 10,428 이벤트 엔리치먼트 실행
- [x] 결과 파일: `poc/data/enrichment_results/full_sync_20260108_012350.json`
- [x] 실제 비용: **$39.52** (예상 $80의 절반!)

**소요 시간**: 110분 (1.8시간)

### CP-1.4: 엔리치먼트 결과 검증 ✅

- [x] 10,427건 성공 (99.99%)
- [x] 위치 정확도 확인: Thermopylae → Greece (38.80, 22.58) ✅
- [x] 연도 정확도 확인: BCE -480년 정상 처리
- [x] 에러 1건: JSON 파싱 에러 (데이터 자체는 정상)

### CP-1.5: DB 적용 ✅

- [x] 스크립트: `poc/scripts/apply_enrichment.py`
- [x] 백업: `events_backup_20260108_080905`
- [x] 10,427건 업데이트 완료
- [x] 9,692건 위치 연결 (93%)

---

## Phase 2: Source-Event 연결 검증

### CP-2.1: text_mentions 데이터 분석

- [ ] 현재 text_mentions 테이블 상태 확인
- [ ] Event-Source 연결 통계:
  - 이벤트당 평균 소스 수
  - 소스 없는 이벤트 수
  - 가장 많은 소스를 가진 이벤트 Top 10

### CP-2.2: 연결 품질 검증

- [ ] 샘플 이벤트의 연결된 소스 확인
- [ ] 잘못 연결된 케이스 식별
- [ ] 연결 정확도 추정

### CP-2.3: 연결 보강 (필요 시)

- [ ] 누락된 연결 보강 방안 수립
- [ ] 실행 (필요 시)

---

## Phase 3: Person & Location 정리

### CP-3.1: Persons 데이터 분석

- [ ] persons 테이블 현재 상태
- [ ] 중복 인물 식별
- [ ] 메타데이터 품질 (생몰년, 국적 등)

### CP-3.2: Persons 엔리치먼트 (필요 시)

- [ ] Person 엔리치먼트 프롬프트 설계
- [ ] 테스트 실행
- [ ] 전체 실행

### CP-3.3: Locations 데이터 분석

- [ ] locations 테이블 현재 상태
- [ ] 중복 위치 식별
- [ ] 좌표 정확도

### CP-3.4: Locations 정리 (필요 시)

- [ ] 중복 병합
- [ ] 좌표 검증/수정

---

## Phase 4: 큐레이션 준비 완료 검증

### CP-4.1: 데이터 품질 최종 점검

- [ ] Events: 95%+ 메타데이터 정확도
- [ ] Source 연결: 90%+ 정확도
- [ ] Persons: 주요 인물 정리 완료
- [ ] Locations: 좌표 정확도 검증

### CP-4.2: 큐레이션 파이프라인 준비

- [ ] Historical Chain 생성 로직 설계
- [ ] 멀티소스 요약 프롬프트 설계
- [ ] 테스트 체인 생성 (예: 페르시아 전쟁)

---

## 큐레이션을 위해 필요한 기초 데이터

### 필수 (Enrichment로 해결)

| 데이터 | 용도 | 엔리치먼트로 해결? |
|-------|------|------------------|
| 정확한 연도 (year_start, year_end) | 타임라인 정렬 | ✅ Yes |
| 정확한 좌표 (lat, lng) | 지도 표시 | ✅ Yes |
| 정확한 제목 (title_clean) | 검색, 표시 | ✅ Yes |
| 한국어 제목 (title_ko) | 다국어 지원 | ✅ Yes |
| 카테고리 (category) | 필터링 | ✅ Yes |
| 시대 (era) | 시대별 탐색 | ✅ Yes |
| 문명권 (civilization) | 문명별 탐색 | ✅ Yes |

### 추가 필요 (Enrichment 후 별도 작업)

| 데이터 | 용도 | 작업 |
|-------|------|------|
| Source-Event 연결 검증 | 멀티소스 요약 | Phase 2 |
| Person-Event 연결 | 인물 스토리 | Phase 3 |
| Location-Event 연결 | 장소 스토리 | Phase 3 |
| 인과관계 (cause-effect) | Causal Chain | 큐레이션 단계 |

---

## 결론: 엔리치먼트 후 남은 작업

### 엔리치먼트만으로 해결되는 것

1. ✅ 이벤트 메타데이터 품질 (연도, 좌표, 제목, 분류)
2. ✅ 지도 표시를 위한 기본 데이터
3. ✅ 타임라인 정렬을 위한 기본 데이터

### 추가로 필요한 작업

1. **Source-Event 연결 검증** (Phase 2)
   - 멀티소스 요약을 위해 어떤 소스가 어떤 이벤트를 언급하는지 정확해야 함
   - 현재 text_mentions로 연결되어 있지만 검증 필요

2. **Person/Location 정리** (Phase 3)
   - Person Story, Place Story를 위해 필요
   - 중복 제거, 메타데이터 보강

3. **인과관계는 큐레이션에서**
   - "마라톤 전투 → 살라미스 해전" 같은 인과관계
   - 이건 기초 데이터가 아니라 큐레이션 결과물

---

## 우선순위 권장

```
1. [지금] CP-1.2~1.5: 엔리치먼트 완료
   └── 가장 임팩트 큼, 지도/타임라인 바로 개선

2. [다음] CP-2.1~2.3: Source 연결 검증
   └── 멀티소스 요약의 기반

3. [나중] CP-3.1~3.4: Person/Location 정리
   └── Person Story, Place Story 준비

4. [이후] Phase 4: 큐레이션 시작
   └── Historical Chain 생성
```

---

## 진행 로그

| 날짜 | 체크포인트 | 상태 | 비고 |
|-----|-----------|------|------|
| 2026-01-07 | CP-1.1 | ✅ 완료 | 100건 테스트 성공, gpt-5.1-chat-latest 선정 |
| 2026-01-08 | CP-1.2 | ✅ 완료 | 요약/한글 제거, 비용 $115→$80 예상 |
| 2026-01-08 | CP-1.3 | ✅ 완료 | 10,428건 처리, 실제 비용 $39.52 |
| 2026-01-08 | CP-1.4 | ✅ 완료 | 99.99% 성공, Thermopylae 수정 확인 |
| 2026-01-08 | CP-1.5 | ✅ 완료 | DB 적용, 9,692건 위치 연결 |

