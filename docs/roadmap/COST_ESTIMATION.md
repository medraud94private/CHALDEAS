# CHALDEAS V2 비용 산정

## 개요

새 구조 구현에 필요한 AI/LLM 호출 비용을 산정합니다.

---

## 1. 데이터 처리 비용

### 1.1 NER 파이프라인

**현재 수집된 텍스트 데이터**:
- Gutenberg: 100+ 텍스트 파일
- CText: 15+ 중국 고전
- Perseus: 그리스/로마 고전
- **총 예상**: ~500개 텍스트, 평균 50KB = 25MB 텍스트

**처리 전략**:
1. **1차 spaCy (무료)**: 모든 텍스트 처리
2. **2차 LLM 검증**: spaCy 결과 중 저신뢰도만 검증

| 단계 | 방식 | 예상 호출량 | 단가 | 비용 |
|-----|------|-----------|------|------|
| 1차 | spaCy (로컬) | 전체 | $0 | **$0** |
| 2차 | GPT-5-nano | 20% (저신뢰도) | ~$0.001/1K tokens | **~$5** |
| 예비 | GPT-5.1-chat-latest | 5% (복잡 케이스) | ~$0.01/1K tokens | **~$12** |

**NER 총 예상 비용**: **~$17**

### 1.2 Period/Era AI 보완

**초기 수동 데이터**: 30개 주요 시대 (무료)
**AI 세부 보완**: 각 시대당 10개 하위 구분

| 작업 | 호출량 | 단가 | 비용 |
|-----|--------|------|------|
| 세부 시대 생성 | 300개 | ~$0.002/개 | **~$0.6** |
| 설명 생성 | 300개 | ~$0.005/개 | **~$1.5** |

**Period 총 예상 비용**: **~$2.1**

### 1.3 Location 계층 구축

**현재 위치 데이터**: 43,956개 (Pleiades 기준)
**계층 연결 필요**: 상위 지역 매칭

| 작업 | 호출량 | 단가 | 비용 |
|-----|--------|------|------|
| 계층 매칭 | 44,000개 × 배치 | ~$0.0005/개 | **~$22** |

**Location 총 예상 비용**: **~$22**

---

## 2. HistoricalChain 생성 비용

### 2.1 초기 시스템 체인 (사전 생성)

중요 인물/장소/시대에 대해 미리 생성

| 유형 | 수량 | 단가 | 비용 |
|-----|------|------|------|
| Person Story | 100명 | ~$0.02/개 | **$2** |
| Place Story | 50곳 | ~$0.02/개 | **$1** |
| Era Story | 30시대 | ~$0.05/개 | **$1.5** |
| Causal Chain | 20개 | ~$0.05/개 | **$1** |

**초기 체인 총 예상 비용**: **~$5.5**

### 2.2 사용자 체인 생성 (런타임)

**예상 월간 쿼리**: 1,000개 (초기)

| 상태 | 비율 | 수량 | 단가 | 월 비용 |
|-----|------|------|------|--------|
| 캐시 히트 | 70% | 700 | $0 | $0 |
| 신규 생성 (nano) | 25% | 250 | $0.01 | $2.5 |
| 신규 생성 (5.1) | 5% | 50 | $0.05 | $2.5 |

**월간 체인 예상 비용**: **~$5/월**

---

## 3. 비용 요약

### 3.1 초기 구축 비용 (일회성)

| 항목 | 비용 |
|-----|------|
| NER 파이프라인 | $17 |
| Period/Era 보완 | $2.1 |
| Location 계층 구축 | $22 |
| 초기 시스템 체인 | $5.5 |
| **초기 구축 총합** | **~$47** |

### 3.2 월간 운영 비용

| 항목 | 비용 |
|-----|------|
| 사용자 체인 생성 | ~$5/월 |
| 텍스트 추가 처리 | ~$2/월 |
| **월간 총합** | **~$7/월** |

### 3.3 연간 총 비용

```
초기 구축: $47
운영 12개월: $7 × 12 = $84
────────────────────────
1년차 총합: ~$131
```

---

## 4. 비용 최적화 전략

### 4.1 캐싱 최대화

```python
# 동일/유사 쿼리 캐시
cache_key = f"{chain_type}:{entity_id}"
if cache.exists(cache_key):
    return cache.get(cache_key)  # 비용 $0
```

**예상 캐시 히트율**: 70% → 비용 70% 절감

### 4.2 배치 처리

```python
# 1000개씩 배치로 처리하면 API 호출 오버헤드 감소
for batch in chunks(entities, 1000):
    results = await process_batch(batch)
```

### 4.3 점진적 품질 향상

```
Level 1 (무료): spaCy만 사용
Level 2 (저비용): spaCy + GPT-5-nano
Level 3 (고비용): spaCy + GPT-5.1-chat-latest

→ 인기 체인만 Level 3으로 재생성
```

### 4.4 오프라인 처리

```
피크 시간대: 캐시 조회만
비피크 시간대: 신규 체인 생성
야간 배치: 시스템 체인 품질 개선
```

---

## 5. 예산 경고 시스템

### 5.1 일일 예산 제한

```python
DAILY_BUDGET = 1.0  # $1/일

async def check_budget():
    spent = await get_today_spending()
    if spent >= DAILY_BUDGET * 0.8:
        logger.warning(f"Budget 80% reached: ${spent}")
    if spent >= DAILY_BUDGET:
        raise BudgetExceededError("Daily budget exceeded")
```

### 5.2 사용량 대시보드

```
[Dashboard]
Today:   $0.32 / $1.00  ████░░░░░░ 32%
This Week: $2.15 / $7.00 ███░░░░░░░ 31%
This Month: $8.50 / $30.00 ███░░░░░░░ 28%
```

---

## 6. 무료 대안

### 6.1 오픈소스 LLM

| 모델 | 용도 | 비용 |
|-----|------|------|
| Llama 3.3 70B | 체인 생성 | 로컬 GPU 필요 |
| Mistral 7B | NER 검증 | 로컬 실행 가능 |
| Ollama | 로컬 호스팅 | 무료 |

**단점**: 품질 차이, GPU 비용, 응답 시간

### 6.2 하이브리드 (권장)

```
개발/테스트: 오픈소스 LLM (무료)
프로덕션: OpenAI API (유료, 품질 보장)
```

---

## 7. 결론

| 구분 | 비용 |
|-----|------|
| **초기 구축** | ~$47 (일회성) |
| **월간 운영** | ~$7/월 |
| **연간 총합** | ~$131/년 |

**비용 대비 가치**:
- 24,000+ 사건에 대한 자동 연결
- 44,000+ 장소의 계층 구조화
- 무제한 AI 큐레이션 체인 생성
- 다국어 지원 (한국어/영어)

---

## 변경 이력

| 날짜 | 변경 내용 |
|-----|----------|
| 2026-01-01 | 초기 비용 산정 |
