# CHALDEAS 구현 단계

> 저장고(Storage) 완성 → 도서관(Library) 완성

---

## 개요

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      구현 로드맵                                         │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│   [1단계: 저장고 완성]                                                   │
│   ────────────────────                                                  │
│   • 원본 텍스트 수집 (Gutenberg 등)                                      │
│   • NER로 엔티티 추출                                                    │
│   • 관계 연결, DB 저장                                                   │
│   • CHALDEAS 지도에 연한 마커 표시                                       │
│                                                                         │
│                         ↓                                               │
│                                                                         │
│   [2단계: 도서관 완성]                                                   │
│   ────────────────────                                                  │
│   • 큐레이터 시스템 구현                                                 │
│   • Chain 생성, 캐싱                                                    │
│   • Premium 모드 (GPT-5.1)                                              │
│   • CHALDEAS 지도에 진한 마커 표시                                       │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

---

## 1단계: 저장고 완성

> 목표: 원본 텍스트에서 역사 데이터를 추출하여 기계적으로 분류

### 1.1 데이터 수집

| 소스 | 현재 상태 | 목표 |
|------|----------|------|
| Gutenberg | 12,031 파일 다운로드 완료 | 역사 카테고리 ~3,000개 필터링 |
| CText | 20 파일 | 중국 고전 추가 수집 |
| Wikidata | 구조화 데이터 있음 | 인물/사건 보강 |
| Perseus | 미수집 | 그리스/로마 원전 |

### 1.2 NER 파이프라인

```
[텍스트 청크] → [spaCy NER] → [Ollama/Qwen 검증] → [엔티티 저장]
                  (무료)         (무료, 로컬)
```

**추출 대상:**
- Person (인물)
- Location (장소)
- Time (시간)
- Event (사건)

**처리 예상 시간:**
- 3,000 books × 25 chunks × 30초 = ~625시간 (26일)
- 병렬 처리 시 단축 가능

### 1.3 엔티티 연결

```
"Julius Caesar" → persons.id = 123 (기존 매칭)
"Gaius Julius"  → persons.id = 123 (별칭으로 연결)
"Unknown General" → persons.id = NEW (신규 생성)
```

### 1.4 DB 스키마

```sql
-- 저장고 테이블
events          -- 사건 (date_start, date_end, importance)
persons         -- 인물 (birth_year, death_year)
locations       -- 장소 (lat, lng, type)
event_persons   -- 사건-인물 연결
event_locations -- 사건-장소 연결
text_sources    -- 원본 텍스트
text_mentions   -- 텍스트 내 언급 (엔티티 연결)
```

### 1.5 CHALDEAS 시각화

- **연한 색 마커**: 저장고 데이터 (아직 정리 안됨)
- 마커 클릭 → 기본 정보만 표시 (원본 텍스트 인용)

### 1.6 완료 기준

- [ ] Gutenberg 역사 카테고리 필터링 완료
- [ ] NER 파이프라인 전체 텍스트 처리 완료
- [ ] events 테이블 10만+ rows
- [ ] persons 테이블 1만+ rows
- [ ] locations 테이블 5만+ rows
- [ ] 지도에 저장고 마커 표시

---

## 2단계: 도서관 완성

> 목표: 큐레이터가 저장고 데이터를 읽고 새 텍스트를 생성

### 2.1 큐레이터 시스템

```
┌─────────────────────────────────────────────────────────────────────────┐
│                      큐레이터 모드                                       │
├─────────────────────────────────────────────────────────────────────────┤
│                                                                         │
│  [Standard Mode]                    [Premium Mode]                      │
│  ────────────────                   ─────────────────                   │
│  모델: Qwen (무료)                  모델: GPT-5.1-chat-latest           │
│  용도: 일반 Q&A                     용도: 아티클 작성                    │
│  결과: 일반 응답                    결과: 특이점(Singularity) 공개       │
│                                                                         │
│  인격 선택 없음                     인격 선택 가능:                      │
│                                     • 헤로도토스 (서사적)               │
│                                     • 사마천 (평가적)                   │
│                                     • 타키투스 (비판적)                 │
│                                     • 아리스토텔레스 (분석적)           │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘
```

### 2.2 Chain 생성

**4가지 체인 유형:**

| 유형 | 예시 | 설명 |
|------|------|------|
| person_story | "소크라테스의 생애" | 인물 중심 |
| place_story | "로마의 2000년" | 장소 중심 |
| era_story | "르네상스 시대" | 시대 중심 |
| causal_chain | "로마 멸망의 원인" | 인과관계 |

### 2.3 캐싱 및 승격

```
[사용자 질문] → [Chain 생성] → [캐시 저장]
                                   ↓
                          [자주 찾으면 승격]
                                   ↓
              user → cached → featured → system
              (5회)   (50회)    (200회)

system 레벨 = 영구 보존, "이전에 정리해둔 게 있는데~"
```

### 2.4 DB 스키마 (도서관)

```sql
-- 도서관 테이블
historical_chains   -- 체인 (title, chain_type, visibility)
chain_segments      -- 체인 세그먼트 (event_id, narrative)
articles            -- 특이점 아티클 (Premium 생성)
curator_personas    -- 큐레이터 인격 설정
```

### 2.5 CHALDEAS 시각화

- **진한 색 마커**: 도서관 데이터 (정리된 콘텐츠)
- **강조 마커**: 특이점 (Premium 아티클)
- 마커 클릭 → Chain/Article 표시

### 2.6 완료 기준

- [ ] Standard 큐레이터 (Qwen) 구현
- [ ] Premium 큐레이터 (GPT-5.1) 구현
- [ ] 4가지 체인 유형 모두 지원
- [ ] 캐싱/승격 시스템 동작
- [ ] 다중 인격 선택 가능
- [ ] 지도에 저장고/도서관 마커 구분 표시
- [ ] 특이점 아티클 10개 이상 생성

---

## 의존성

```
1단계 완료 없이 2단계 불가능

[저장고] ──────────────────────> [도서관]
         큐레이터가 읽을 데이터 필요
```

---

## 타임라인 (예상)

| 단계 | 작업 | 예상 기간 |
|------|------|----------|
| **1단계** | Gutenberg 필터링 | - |
| | NER 파이프라인 실행 | - |
| | 엔티티 연결 | - |
| | 저장고 마커 표시 | - |
| **2단계** | 큐레이터 시스템 | - |
| | Chain 생성 | - |
| | Premium 모드 | - |
| | 도서관 마커 표시 | - |

> 시간 산정 없이, 작업 순서만 정의

---

## 현재 상태

### 완료
- [x] PoC에서 Chain 생성 테스트 완료
- [x] NER 파이프라인 (spaCy + Ollama) 테스트 완료
- [x] V1 아키텍처 문서 작성 완료

### 진행 중
- [ ] 1단계: 저장고 완성

### 대기 중
- [ ] 2단계: 도서관 완성
